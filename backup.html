<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Making Watson a Rockstar: Integrating IBM Watson on Bluemix with Spotify and Genius.com</title><link rel="schema.DC" href="http://purl.org/DC/elements/1.0/" /><link rel="SHORTCUT ICON" href="http://www.ibm.com/favicon.ico" /><meta name="DC.Rights" content="© Copyright IBM Corporation 2015"></meta><meta name="Keywords" content=", tttbalca, dddrca"></meta><meta name="DC.Date" scheme="iso8601" content="2014-02-25"></meta><meta name="Source" content="v17 delivery:developerWorks" /><meta name="Security" content="Public" /><meta name="Abstract" content="Build a Node.js application to connect to your Spotify account, fetch song lyrics from Genius.com, and then use Watson APIs to do fun things with those lyrics. This article includes a demo, sample code, and full instructions for authenticating with Spotify, then fetching lyrics, and connecting to the Watson APIs on Bluemix. This particular app will show you how to build an app which quizzes you on your foreign language skills by presenting the lyrics of your favorite songs in Spanish in a quiz-like format."></meta><meta name="Description" content="Build a Node.js application to connect to your Spotify account, fetch song lyrics from Genius.com, and then use Watson APIs to do fun things with those lyrics. This article includes a demo, sample code, and full instructions for authenticating with Spotify, then fetching lyrics, and connecting to the Watson APIs on Bluemix. This particular app will show you how to build an app which quizzes you on your foreign language skills by presenting the lyrics of your favorite songs in Spanish in a quiz-like format."></meta><meta name="IBM.Effective" scheme="W3CDTF" content="2015-12-22"></meta><meta name="Owner" content="developerWorks Content/Raleigh/IBM"></meta><meta name="DC.Language" scheme="rfc1766" content="en" /><meta name="IBM.SpecialPurpose" content="SP001" /><meta name="IBM.Country" content="ZZ" /><meta name="Robots" content="index,follow" /><!-- HEADER_SCRIPTS_AND_CSS --><!--calling dw-header-article-v17 local=worldwide--><link href="http://1.www.s81c.com/common/v17/css/www.css" rel="stylesheet" title="www" type="text/css" xmlns="" /><link href="http://dw1.s81c.com/developerworks/css/v17/ps/dw-article-ps-preview.css" rel="stylesheet" title="www" type="text/css" xmlns="" /><link href="http://dw1.s81c.com/developerworks/css/v17/ps/dw-article-ps-commenting.css" rel="stylesheet" title="www" type="text/css" xmlns="" /><script type="text/javascript" src="http://1.www.s81c.com/common/js/dojo/www.js" xmlns="">//</script><script type="text/javascript" src="http://dw1.s81c.com/developerworks/js/v17/dw-www.js" xmlns="">//</script><script type="text/javascript" xmlns="">
		//  ibmweb.config.set({ sbs: { enabled: false }});
	</script><link rel="stylesheet" type="text/css" href="http://dw1.s81c.com/developerworks/css/v17/ps/orion/built-editor.css" xmlns="" /><script type="text/javascript" src="http://dw1.s81c.com/developerworks/js/v17/ps/orion/built-editor.min.js" xmlns="">//</script><script type="text/javascript" xmlns="">
		require(["orion/editor/edit"], function(edit) {
		edit({className: "editor"});
		});
	</script><style>
            .dw-mask{
                position:fixed;
                top:0;
                left:0;
                width:100%;
                height:100%;
                z-index:9000;
                display:none;
                background:none repeat scroll 0 0 #000000;
                opacity:0.25;
            }
            .dw-modal .dw-modal-body{
                display:none;
                z-index:9999;
                padding:0 11px 0 0;
                background:none repeat scroll 0 0 transparent;
                border:8px solid rgba(255, 255, 255, 0.2);
                border-radius:8px 8px 8px 8px;
                box-shadow:0 0 20px #333333;
                overflow:visible;
                position:fixed;
            }
            .dw-modal .dw-modal-authorbio{
                width:400px;
                min-height:120px;
            }
            .dw-modal .dw-modal-code{
                max-width:960px;
                max-height:500px;
                overflow:scroll;
                background-color:white;
            }
            .dw-modal .dw-modal-code .dw-modal-content{
                max-width:inherit;
            }
            .dw-modal .dw-modal-video{
                width:640px;
                height:360px;
            }
            .dw-modal .dw-modal-video iframe{
                position:relative;
                top:-10px;
                margin-top:0 !important;
            }
            .dw-video-thumbnail-wrapper{
                max-width:300px;
                max-height:200px;
            }
            .dw-video-thumbnail-wrapper-lg{
                max-width:620px;
                max-height:430px;
            }
            .dw-modal-content{
                background-color:white;
                padding:5px;
                width:inherit;
                height:inherit;
            }
            .dw-modal p{
                padding:15px 0 0 20px !important;
                width:360px !important;
            }
            .dw-modal-content .close{
                cursor:pointer;
                display:block;
                position:fixed;
                z-index:999;
                color:#fff;
                background-color:#000;
                font-weight:600;
                border-radius:15px;
                text-decoration:none;
            }</style><script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"><!--.--></script><script>
		    $(document).ready(function() {
		        //When previews are viewed locally, standard overlay function fails.
		        //This jQuery mimics the overlay function for preview purposes only.
		        $('a.dw-modal-reveal').click(function(e) {
		        e.preventDefault();
		        var modalID = $(this).attr('href');
		        
		        $('.dw-mask').show();
		        
		        //Get the window height and width
		        var winH = $(window).height();
		        var winW = $(window).width();
		        //Set the popup to center
		        $(modalID).css('top', winH/2-$(modalID).height()/2);
		        $(modalID).css('left', winW/2-$(modalID).width()/2);
		        //Move the close button to the right side of the popup
		        $('.close').css('right', winW/2-$(modalID).width()/2);
		        $('.close').css('top', winH/2-$(modalID).height()/2);
		        
		        $(modalID).show();
		        });
		        
		        //if close button is clicked
		        $('.dw-modal-body .close').click(function (e) {
		        e.preventDefault();
		        $('.dw-mask, .dw-modal-body').hide();
		        });
		        
		        //if mask is clicked
		        $('.dw-mask').click(function () {
		        $('.dw-mask').hide();
		        $('.dw-modal-body').hide();
		        });
		        
		        //if ESC key is pressed
		        $(document).keydown(function(event) {
		            if (event.which == 27) {
		                event.preventDefault();
		                $('.dw-modal-body').hide();
		                $('.dw-mask').hide();
		            }
		        });
		    });
		</script></head><body id="ibm-com"><div id="ibm-top" class="ibm-landing-page"><!-- MASTHEAD_BEGIN --><div id="ibm-masthead"><div id="ibm-mast-options"><ul><li id="ibm-geo" /></ul></div><div id="ibm-universal-nav"><ul id="ibm-unav-links"><li id="ibm-home"><a href="http://www.ibm.com/us/en/">IBM®</a></li></ul><div id="ibm-search-module">&nbsp;</div></div></div><!-- MASTHEAD_END --><!-- LEADSPACE_BEGIN --><div id="ibm-leadspace-head" class="ibm-alternate" xmlns=""><div id="ibm-leadspace-body"><!-- Navigation_Trail --><ul id="ibm-navigation-trail"><li><a href="http://www.ibm.com/developerworks/">developerWorks</a></li></ul><!-- Title_Subtitle --><h1 class="dw-article-ps-title">Making Watson a Rockstar: Integrating IBM Watson on Bluemix with Spotify and Genius.com</h1></div></div><!-- LEADSPACE_END --><div id="ibm-pcon" xmlns=""><div id="ibm-content"><div id="ibm-content-body"><div id="ibm-content-main"><div class="ibm-columns"><div id="dw-article-ps-date" class="ibm-col-6-1">25 February 2014</div><div id="dw-article-ps-pdf" class="ibm-col-6-1"><a class="ibm-pdf-link" href="template-dw-article-alt1-7.0-pdf.pdf">PDF</a> (535KB)</div><div class="ibm-col-6-4"> </div></div><div class="ibm-columns"><div class="ibm-col-6-1"><div id="dw-article-ps-author-img"><img width="70" height="70" src="https://avatars3.githubusercontent.com/u/4561071" alt="Kevin DeLand" /></div><p class="dw-article-ps-author"><a href="https://www.ibm.com/developerworks/community/profiles/html/profileView.do?key=7d2d9d39-9f15-4a90-844d-24ad75e2bca0&amp;lang=en">Kevin DeLand</a></p><p class="dw-article-ps-author-title"><span>Staff Software Engineer</span></p><p class="dw-article-ps-author-contact"><a href="https://twitter.com/DeLandB4Time">@DeLandB4Time</a></p></div><div class="ibm-col-6-4"><p>There is a growing movement (commonly called the STEAM movement) to integrate the Arts into STEM (Science, Technology, Engineering, Math), in orer to pique the interest of those, especially kids, who would not typically be interested in STEM topics.</p><div class="ibm-pull-quote"><blockquote><p style="color:#f19027&#xA;                            !important;"><em><span class="ibm-pullquote-open" style="color:#f19027&#xA;                                    !important;">“</span>Waton's powerful language tools have been used to analyze everything from Jeopardy questions to medical documents. Why not expand Watson's expertise into the realm of art and entertainment?<span class="ibm-pullquote-close" style="color:#f19027&#xA;                                    !important;">”</span></em></p></blockquote><p class="ibm-pullquote-source"></p></div><p>This article will give you a foundation to connect the powerful langauge processing capabilities of Watson to the songs and lyrics you love. We will start by authenticating with a Spotify account to retrieve playlists of popular songs, then fetching those song lyrics from <a href="http://genius.com">genius.com</a>, and finally using the Watson Developer Cloud to do fun and interesting things with the lyrics.</p><p>In this installment of "Making Watson a Rock Star", we will use the Watson Language Translation service to translate the lyrics of popular songs into Spanish, to help English-speaking users improve their Spanish in a way that is fun, engaging, and memorable.</p><div class="ibm-columns"><div class="ibm-col-6-2&#xA;                            dw-article-ps-button"><p class="ibm-button-link-alternate"><a href="http://cuantos-caminos.mybluemix.net/">Run the app</a></p></div><div class="ibm-col-6-2"><p class="ibm-button-link-alternate"><a href="https://hub.jazz.net/project/srich/Sentiment%20Analysis%20App">Get the code at GitHub</a></p></div></div><div class="dw-article-ps-hbox"><h2 id="IDKRUB0OCQIEDGCDDRYBEZGLMSYCP0LE44DWI5URL5WH3V2J5H4Q5H">What you'll need to build a similar
                app</h2><div id="cmt_1" class="cmt_icon"></div><div class="cmt_arrow">&nbsp;</div></div><ol><li>A Bluemix account</li><li>A basic familiarity with <a href="http://www.ibm.com/developerworks/library/j-nodejs/index.html">Node.js</a> and a Node.js development environment.</li><li>These Node.js modules:
              <ul class="ibm-bullet-list"><li><a href="https://github.com/visionmedia/express">Express framework</a>: Makes it easy to build
                Node.js web apps.</li><li><a href="http://simplesentimentanalysis.bluemix.net/">Watson Developer Cloud</a>: Provides many SDKs that use cognitive computing to solve complex problems.</li><li><a href="https://github.com/kenshiro-o/RapGenius-JS">RapGenius-JS module</a>: Provides a client that enables you to query genius.com (formerly rapgenius.com) and retrieve information about rap and rock artists and songs.</li></ul></li></ol><p class="dw-article-ps-see-blk"><span class="dw-article-ps-see-head">WATCH:</span><a class="dw-article-ps-see" href="http://www.ibm.com/developerworks/offers/lp/demos/summary/j-jnodejs.html">Getting started with Node.js (video demo)</a></p><p class="dw-article-ps-see-blk"><span class="dw-article-ps-see-head">READ:</span><a class="dw-article-ps-see" href="https://developers.google.com/accounts/docs/OAuth2">OAuth 2.0 authentication</a></p><p>The steps below describe the most basic approach. For more
                advanced tooling to speed your development, see <a href="#tools">Additional tooling considerations</a>.</p><div class="dw-article-ps-hbox"><h2 id="IDSGISKD034Z1MMH1PHHP0IWZOHJUSINCQOQDXMGUD0HZIEHNGPNK">Step 1. Fork the application code from github</h2><div id="cmt_2" class="cmt_icon"></div><div class="cmt_arrow">&nbsp;</div></div><ol><li>Run the <code>node</code> and <code>npm</code> commands: <h5>Figure 1. Confirming that Node.js and NPM
                            are set up on your system</h5><img alt="Screen shot of running the node and npm commands" src="fig1.jpg" width="450" /></li><li>Create the simplest Node.js Express app possible: Hello
                    Node.js (see <a href="#listing1">Listing 1</a>). <p>In a new
                        directory, create the app.js file, the main file of the
                        Node.js app. Tell Node.js that the Express module is
                        required, and create the Express app. Register a route
                        so that requests for <code>/hello</code> will be handled
                        by the anonymous function shown in <a href="#listing1">Listing 1</a>. The handler for
                        <code>/hello</code> uses the Express helpers to send a
                        simple text response. The send method handles details
                        such as defaulting the content type and length. When
                        using Express, we can ignore some of the details of the
                        underlying HTTP conversation.</p><h5 id="listing1">Listing 1. Hello Node.js</h5><p><a href="#ID1P14N1HXNST3EZCQ110SACOQKH0D1FIXEHNYLBOW1QKS55A2VFNO" class="ibm-popup-link dw-modal-reveal">Click to see code listing</a></p><div class="dw-modal"><div id="ID1P14N1HXNST3EZCQ110SACOQKH0D1FIXEHNYLBOW1QKS55A2VFNO" class="dw-modal-body dw-modal-code"><div class="dw-modal-content"><p><a href="#close-ID1P14N1HXNST3EZCQ110SACOQKH0D1FIXEHNYLBOW1QKS55A2VFNO" class="close"> x </a></p><div class="ibm-body"><div class="ibm-main"><div class="ibm-title"><h2>Listing 1. Hello Node.js</h2></div><div class="ibm-container ibm-alternate"><div class="ibm-container-body"><div class="codesection"><pre class="displaycode no-auto-overflow">var port = (process.env.VCAP_APP_PORT || 3000);
var express = require("express");

var app = express();

app.get('/hello', function(req, res) {
    res.send("Hello world.");
});

app.listen(port);
console.log("Server listening on port " + port);</pre></div></div></div></div></div></div></div></div><p><strong>Note:</strong> The program could be even simpler,
                        but a few additional lines of code enable it to run in
                        the CloudFoundry runtime. In CloudFoundry, the app will
                        be relocated to a different port (the port can be
                        discovered from the environment).</p></li><li>Give Node.js some additional information about the app, as
                    shown in <a href="#listing2">Listing 2</a>. <p> Create a
                        <code>package.json</code> file to tell the app that the
                        Express module will be used, and name the app "Simple
                        Sentiment Analysis App." Since this app is not intended
                        to be published to the NPM registry, you can mark it as
                        private. Finally, declare that the app depends on a 3.x
                        version of the Express module.</p><h5 id="listing2">Listing 2. package.json</h5><p><a href="#ID5GS0G4FCWYIIHSDIQ5ODXUBQICVSCSVW1X0VHKGKWOAC2LXVDVFK" class="ibm-popup-link dw-modal-reveal">Click to see code listing</a></p><div class="dw-modal"><div id="ID5GS0G4FCWYIIHSDIQ5ODXUBQICVSCSVW1X0VHKGKWOAC2LXVDVFK" class="dw-modal-body dw-modal-code"><div class="dw-modal-content"><p><a href="#close-ID5GS0G4FCWYIIHSDIQ5ODXUBQICVSCSVW1X0VHKGKWOAC2LXVDVFK" class="close"> x </a></p><div class="ibm-body"><div class="ibm-main"><div class="ibm-title"><h2>Listing 2. package.json</h2></div><div class="ibm-container ibm-alternate"><div class="ibm-container-body"><div class="codesection"><pre class="displaycode no-auto-overflow">package.json for Hello Node
{
  "name": "SimpleSentimentAnalysisApp",
  "description": "Simple Sentiment Analysis App",
  "version": "0.9.0",
  "private": true,
  "dependencies": {
    "express": "3.x"
  }
}</pre></div></div></div></div></div></div></div></div></li></ol><div class="dw-article-ps-hbox"><h3 id="ID5UL5CHHY1HSBIHBBABEHBE31RH3YTHNP5LN03PGAL5ULFTSGETDM">Run and
                test your Hello Node.js app</h3><div id="cmt_3" class="cmt_icon"></div><div class="cmt_arrow">&nbsp;</div></div><p>Next, run and test the Hello Node.js app using these steps:</p><ol><li>Before running your app, prepare the node environment using
                    NPM to fetch the dependencies declared for the app (and
                    their dependencies and so on). <h5>Figure 2. Prepare the node
                            environment</h5><img alt="Screen shot of running the npm install command" src="fig2.jpg" width="610" /><p>The result of a successful NPM install is the creation of
                        the <code>node_modules</code> directory, populated with
                        the required modules.</p></li><li>Type <code>node app.js</code> at the command line. <h5>Figure 3. Run the node app.js
                            command</h5><img src="fig3.jpg" alt="Screen shot of running the node app.js command" width="322" /><p>The message "Server listening on port 3000" confirms that
                        the app has started and is listening for
                    requests.</p></li><li>Test the behavior of the app by pointing a browser to <a href="http://localhost:3000/hello">http://localhost:3000/hello</a>. <h5>Figure 4. Test the behavior of the
                            app</h5><img alt="Screen shot of pointing a browser to //localhost:3000/hello" src="fig4.jpg" width="292" /></li></ol><div class="dw-article-ps-hbox"><h2 id="IDPMHN5JRCMD31KGXHQIIES2PEDHAMCTFW0WBK4HLS4R5JZELPXODL">Step 2. Create an app in Bluemix and bind it to a Watson Language Translation service</h2><div id="cmt_4" class="cmt_icon"></div><div class="cmt_arrow">&nbsp;</div></div><p>Now that your basic app is running and the environment is set up,
                it's time to add some real function using the very cool
                    <strong>sentiment</strong> module by Andrew Sliwinsky. He
                describes it as "a Node.js module that uses the AFINN-111
                wordlist to perform sentiment analysis on arbitrary blocks of
                input text." This is a relatively simple implementation of
                sentiment analysis, as you'll see. It simply scores the words in
                your text using a dictionary of English words that have been
                rated for positive or negative sentiment.</p><ol><li>To begin using the sentiment module, update the
                    <code>package.json</code> to include it as a dependency: <h5 id="listing3">Listing 3. Update
                            package.json</h5><p><a href="#IDNZT3MKEFSLJMNCYENQ5NPDQEIK1SIEX0GHGVNZE2WO00B2RBBVFI" class="ibm-popup-link dw-modal-reveal">Click to see code listing</a></p><div class="dw-modal"><div id="IDNZT3MKEFSLJMNCYENQ5NPDQEIK1SIEX0GHGVNZE2WO00B2RBBVFI" class="dw-modal-body dw-modal-code"><div class="dw-modal-content"><p><a href="#close-IDNZT3MKEFSLJMNCYENQ5NPDQEIK1SIEX0GHGVNZE2WO00B2RBBVFI" class="close"> x </a></p><div class="ibm-body"><div class="ibm-main"><div class="ibm-title"><h2>Listing 3. Update
                            package.json</h2></div><div class="ibm-container ibm-alternate"><div class="ibm-container-body"><div class="codesection"><pre class="displaycode no-auto-overflow">{
  "name": "SimpleSentimentAnalysisApp",
  "description": "Simple Sentiment Analysis App",
  "version": "0.9.0",
  "private": true,
  "dependencies": {
    "express": "3.x",
    <strong>"sentiment": "0.2.1"</strong>
  }
}</pre></div></div></div></div></div></div></div></div></li><li>Tell Node.js to get this new module with the command
                    <code>npm
                        update</code>. (Note: The
                    docs suggest that <code>npm install</code> should also have
                    picked up the new dependency, but that was not the behavior
                    I saw.) </li><li>Require the new sentiment module: <p><a href="#IDHV3R3L3FRVE1G1KEXGIQK02J2CAVWXWEZYCKZIJGSYJXELQQ0SCK" class="ibm-popup-link dw-modal-reveal">Click to see code listing</a></p><div class="dw-modal"><div id="IDHV3R3L3FRVE1G1KEXGIQK02J2CAVWXWEZYCKZIJGSYJXELQQ0SCK" class="dw-modal-body dw-modal-code"><div class="dw-modal-content"><p><a href="#close-IDHV3R3L3FRVE1G1KEXGIQK02J2CAVWXWEZYCKZIJGSYJXELQQ0SCK" class="close"> x </a></p><div class="ibm-body"><div class="ibm-main"><div class="ibm-container ibm-alternate"><div class="ibm-container-body"><div class="codesection"><pre class="displaycode no-auto-overflow">var express = require("express");</pre></div></div></div></div></div></div></div></div></li><li>Create another route to experiment with the sentiment
                    module: <h5 id="listing4">Listing 4. The sentiment analysis app
                            interface code</h5><p><a href="#ID5I2J2RVPNTCOL5FBQ04ELXWEPFZNYBWJ4MOLLKNBSKG0JJXFEYUK" class="ibm-popup-link dw-modal-reveal">Click to see code listing</a></p><div class="dw-modal"><div id="ID5I2J2RVPNTCOL5FBQ04ELXWEPFZNYBWJ4MOLLKNBSKG0JJXFEYUK" class="dw-modal-body dw-modal-code"><div class="dw-modal-content"><p><a href="#close-ID5I2J2RVPNTCOL5FBQ04ELXWEPFZNYBWJ4MOLLKNBSKG0JJXFEYUK" class="close"> x </a></p><div class="ibm-body"><div class="ibm-main"><div class="ibm-title"><h2>Listing 4. The sentiment analysis app
                            interface code</h2></div><div class="ibm-container ibm-alternate"><div class="ibm-container-body"><div class="codesection"><pre class="displaycode no-auto-overflow">app.get('/testSentiment',
    function (req, res) {
        var response = "&lt;HEAD&gt;" +
          "&lt;title&gt;Twitter Sentiment Analysis&lt;/title&gt;\n" +
          "&lt;/HEAD&gt;\n" +
          "&lt;BODY&gt;\n" +
          "&lt;P&gt;\n" +
          "Welcome to the Twitter Sentiment Analysis app.  " +   
          "What phrase would you like to analzye?\n" +                
          "&lt;/P&gt;\n" +
          "&lt;FORM action=\"/testSentiment\" method=\"get\"&gt;\n" +
          "&lt;P&gt;\n" +
          "Enter a phrase to evaluate: &lt;INPUT type=\"text\" name=\"phrase\"&gt;&lt;BR&gt;\n" +
          "&lt;INPUT type=\"submit\" value=\"Send\"&gt;\n" +
          "&lt;/P&gt;\n" +
          "&lt;/FORM&gt;\n" +
          "&lt;/BODY&gt;";
        var phrase = req.query.phrase;
        if (!phrase) {
            res.send(response);
        } else {
            sentiment(phrase, function (err, result) {
                response = 'sentiment(' + phrase + ') === ' + result.score;
                res.send(response);
            });
        }

    });</pre></div></div></div></div></div></div></div></div><p>Apologies to web architects and designers everywhere for
                        the brute force simplicity of this new function. I
                        promise we’ll do something more intelligent later. For
                        now, we’re going to put up a form that lets us enter a
                        phrase and then respond with the rating provided by
                        sentiment. The key function call is
                            <strong><code>sentiment(phrase, function)</code></strong>.
                        In the spirit of Node.js, the sentiment library is
                        asynchronous, so the result of the analysis is processed
                        by a callback function.</p></li><li>Restart the app and point a browser to <a href="http://localhost:3000/testSentiment">http://localhost:3000/testSentiment</a>. <h5>Figure 5. The sentiment analysis app user
                            interface</h5><img alt="Screen capture showing a browser pointing to localhost:3000/testSentiment" src="fig5.jpg" width="432" /></li></ol><div class="ibm-pull-quote"><blockquote><p style="color:#f19027&#xA;                            !important;"><em><span class="ibm-pullquote-open" style="color:#f19027&#xA;                                    !important;">“</span>Et voil&#224;, a fabulous user interface for
                    sentiment analysis!<span class="ibm-pullquote-close" style="color:#f19027&#xA;                                    !important;">”</span></em></p></blockquote><p class="ibm-pullquote-source"></p></div><div class="dw-article-ps-hbox"><h3 id="ID5PRDWZNIJ0DPBS4YZWANOQXZWGYSJFBFXHDFRRGVCU4RJWC1G4TJ">Scoring
                sample sentiments</h3><div id="cmt_5" class="cmt_icon"></div><div class="cmt_arrow">&nbsp;</div></div><p>Here are some hypothetical results from our sentiment analysis
                app:</p><h5 id="table1">Table 1. Hypothetical results of analyzing
                    "Node.js"</h5><table border="0" cellpadding="0" cellspacing="0" class="ibm-data-table"><thead xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:dw="http://www.ibm.com/developerWorks/"><tr><th scope="col">Sentiment</th><th class="ibm-numeric" scope="col">Score</th><th scope="col">Interpretation</th></tr></thead><tbody xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:dw="http://www.ibm.com/developerWorks/"><tr><th class="ibm-table-row" scope="row">Node.js is cool, I
                            love it</th><td class="ibm-numeric">4</td><td>Very positive sentiment</td></tr><tr><th class="ibm-table-row" scope="row">Node.js is uncool,
                            I hate it</th><td class="ibm-numeric">-3</td><td>Very negative sentiment</td></tr><tr><th class="ibm-table-row" scope="row">Mi piace Node.js.
                            Node.js &#233; bellissima</th><td class="ibm-numeric">0</td><td>No sentiment detected. Sentiment has only an English
                            dictionary.</td></tr><tr><th class="ibm-table-row" scope="row">Node.js is not
                            cool, I do not love it</th><td class="ibm-numeric">4</td><td>Oops! Very positive, same score as the first
                            example. Sentiment is not aware of grammar or
                            negation.</td></tr></tbody></table><p>You can see the limitations of this approach, namely that the
                sentiment module only has an English dictionary and is not aware
                of grammar or negation. Still, it’s probably good enough to get
                the gist of most tweets.</p><div class="dw-article-ps-hbox"><h2 id="IDLEORJD0RUJKVJKAOTEUUE2H21B2B03AP5AHG5EB2QJ4NHXPNETFO">Step 3. Register your application with Spotify.</h2><div id="cmt_6" class="cmt_icon"></div><div class="cmt_arrow">&nbsp;</div></div><p>The other essential component of the app is the connection to
            Spotify, so that it can retrieve songs and playlists.</p><div class="dw-article-ps-sidebar"><p><strong>Twitter’s Stream interface</strong> is perfect for
                    observing trends in sentiment, since it allows access to all
                    of the Twitter content on a topic over time.</p><p>Our app works only with the public Twitter stream, so
                    Twitter’s Application-only Authentication scheme is
                    sufficient. This simplified OAuth exchange doesn’t require a
                    user login or consent prompt. Using this method does require
                    an app-specific set of OAuth keys, which are encoded in the
                    app. For more, see <a href="https://dev.twitter.com/docs/streaming-apis">Twitter streaming APIs</a>.</p></div><ol><li>Go to <a href="https://developer.spotify.com/my-applications">developer.spotify.com</a> and login using your Spotify (or Facebook account).  </li><li>Obtain a set of keys by registering it under your Twitter
                    developer account. Go to the Twitter "My Applications" page
                    to create and manage the app.</li><li>Add a couple of functions to your app to test the connection
                    to Twitter. First construct a twitter object using ntwitter
                    and OAuth keys, then make a simple call to verify those
                    credentials. <br /><br /><h5 id="listing5">Listing 5. Testing your Twitter
                            connection</h5><p><a href="#IDXKJH1G5HEWCSNN0UYMFUDOSMRCA5EDKGST1YTH3PA3IFHFPSZVL" class="ibm-popup-link dw-modal-reveal">Click to see code listing</a></p><div class="dw-modal"><div id="IDXKJH1G5HEWCSNN0UYMFUDOSMRCA5EDKGST1YTH3PA3IFHFPSZVL" class="dw-modal-body dw-modal-code"><div class="dw-modal-content"><p><a href="#close-IDXKJH1G5HEWCSNN0UYMFUDOSMRCA5EDKGST1YTH3PA3IFHFPSZVL" class="close"> x </a></p><div class="ibm-body"><div class="ibm-main"><div class="ibm-title"><h2>Listing 5. Testing your Twitter
                            connection</h2></div><div class="ibm-container ibm-alternate"><div class="ibm-container-body"><div class="codesection"><pre class="displaycode no-auto-overflow">// Sample keys for demo and article - you must get your own keys 
//   if you clone this application!
// Create your own app at: https://dev.twitter.com/apps
var tweeter = new twitter({
    consumer_key: 'your',
    consumer_secret: 'keys',
    access_token_key: ‘go',
    access_token_secret: 'here'
});

app.get('/twitterCheck', function (req, res) {
    tweeter.verifyCredentials(function (error, data) {
        res.send("Hello, " + data.name + ".  I am in your twitters.");
    });
});</pre></div></div></div></div></div></div></div></div></li><li>Restart the app and visit <code>/twitterCheck</code> to see
                    that the connection and login to Twitter are working: <h5>Figure 6. Test the connection to
                            Twitter</h5><img alt="Test the connection to Twitter" src="fig0-0.png" width="432" /><p>Note that it does identify me as the owner of the app
                        that is connecting.</p></li><li>Now that the connection to Twitter is established, add a
                    function to monitor Twitter for one or more phrases.
                    ntwitter provides a very simple method for doing this: <ol class="ibm-alpha-list" type="a"><li>Call <code>stream()</code> and pass the phrase to be
                            monitored.</li><li>Use a callback function to process tweets as they
                            arrive. <p>The Twitter Stream API allows the app to
                                open a Stream and keep pulling data as long as
                                it is available. This function works perfectly
                                for the Node.js app, because it can keep a
                                stream open on the server and update counters
                                and average sentiment as it processes the
                                stream.</p></li><li>Create a simple interface to set the phrase to be
                            monitored and to display the results as they come
                            in. A more sophisticated app could store the Tweets
                            to a database for more complex processing.</li></ol></li></ol><p>Listing 6 shows the essence of the code to open a stream and log
                a sample of the tweets:</p><h5 id="listing6">Listing 6. Opening a stream and logging
                    tweets</h5><p><a href="#ID1DBMWRBV5QWZI2TSJRMBOZTLZOIMD5M0IWIQV2GHZYCBVXIZ1MPP" class="ibm-popup-link dw-modal-reveal">Click to see code listing</a></p><div class="dw-modal"><div id="ID1DBMWRBV5QWZI2TSJRMBOZTLZOIMD5M0IWIQV2GHZYCBVXIZ1MPP" class="dw-modal-body dw-modal-code"><div class="dw-modal-content"><p><a href="#close-ID1DBMWRBV5QWZI2TSJRMBOZTLZOIMD5M0IWIQV2GHZYCBVXIZ1MPP" class="close"> x </a></p><div class="ibm-body"><div class="ibm-main"><div class="ibm-title"><h2>Listing 6. Opening a stream and logging
                    tweets</h2></div><div class="ibm-container ibm-alternate"><div class="ibm-container-body"><div class="codesection"><pre class="displaycode no-auto-overflow">app.get('/watchTwitter', function (req, res) {
    var stream;
    var testTweetCount = 0;
    var phrase = 'bieber';
    tweeter.verifyCredentials(function (error, data) {
        if (error) {
            res.send("Error connecting to Twitter: " + error);
        }
        stream = tweeter.stream('statuses/filter', {
            'track': phrase
        }, function (stream) {
            res.send("Monitoring Twitter for \'" + phrase 
                + "\'...  Logging Twitter traffic.");
            stream.on('data', function (data) {
                testTweetCount++;
                // Update the console every 50 analyzed tweets
                if (testTweetCount % 50 === 0) {
                    console.log("Tweet #" + testTweetCount + ":  " + data.text);
                }
            });
        });
    });
});</pre></div></div></div></div></div></div></div></div><div class="dw-article-ps-hbox"><h2 id="ID0CJSG3NGCZALGS4QBQKKER2YSHW5JYVRGOBT1XKZBP3AJU3ZC20H">Step 4. Put it all
                together</h2><div id="cmt_7" class="cmt_icon"></div><div class="cmt_arrow">&nbsp;</div></div><p>Okay, now we have all the parts in place to complete your
                app:</p><ul class="ibm-bullet-list"><li>A basic Express app to serve up various pages</li><li>A sentiment analysis function to assess the sentiment of
                    text</li><li>A connection to Twitter to provide a source of tweets to
                    analyze</li></ul><p>Now we just need to combine them to do something interesting. The
                finished app will prompt the user for a phrase, call Twitter to
                open a stream filtered on the phrase, analyze the sentiment of
                each matching tweet, and create a page to monitor the sentiment
                over time.</p><p>Keeping the user interface very simple, Listing 7 shows the full
                application, in all its Old School Struts-style glory:</p><h5 id="listing7">Listing 7. The full application</h5><p><a href="#IDGLDFLGXEKBOUK1SNSTSYZCWEZLVVANBMRRSUJ2DAFADQYML1450C" class="ibm-popup-link dw-modal-reveal">Click to see code listing</a></p><div class="dw-modal"><div id="IDGLDFLGXEKBOUK1SNSTSYZCWEZLVVANBMRRSUJ2DAFADQYML1450C" class="dw-modal-body dw-modal-code"><div class="dw-modal-content"><p><a href="#close-IDGLDFLGXEKBOUK1SNSTSYZCWEZLVVANBMRRSUJ2DAFADQYML1450C" class="close"> x </a></p><div class="ibm-body"><div class="ibm-main"><div class="ibm-title"><h2>Listing 7. The full application</h2></div><div class="ibm-container ibm-alternate"><div class="ibm-container-body"><div class="codesection"><pre class="displaycode no-auto-overflow">var tweetCount = 0;
var tweetTotalSentiment = 0;
var monitoringPhrase;

function resetMonitoring() {
    monitoringPhrase = "";
}

function beginMonitoring(phrase) {
    var stream;
    // cleanup if we're re-setting the monitoring
    if (monitoringPhrase) {
        resetMonitoring();
    }
    monitoringPhrase = phrase;
    tweetCount = 0;
    tweetTotalSentiment = 0;
    tweeter.verifyCredentials(function (error, data) {
        if (error) {
            return "Error connecting to Twitter: " + error;
        } else {
            stream = tweeter.stream('statuses/filter', {
                'track': monitoringPhrase
            }, function (stream) {
                console.log("Monitoring Twitter for " + monitoringPhrase);
                stream.on('data', function (data) {
                    // only evaluate the sentiment of English-language tweets
                    if (data.lang === 'en') {
                        sentiment(data.text, function (err, result) {
                            tweetCount++;
                            tweetTotalSentiment += result.score;
                        });
                    }
                });
            });
            return stream;
        }
    });
}

function sentimentImage() {
    var avg = tweetTotalSentiment / tweetCount;
    if (avg &gt; 0.5) { // happy
        return "/images/excited.png";
    }
    if (avg &lt; -0.5) { // angry
        return "/images/angry.png";
    }
    // neutral
    return "/images/content.png";
}

app.get('/',
    function (req, res) {
        var welcomeResponse = "&lt;HEAD&gt;" +
            "&lt;title&gt;Twitter Sentiment Analysis&lt;/title&gt;\n" +
            "&lt;/HEAD&gt;\n" +
            "&lt;BODY&gt;\n" +
            "&lt;P&gt;\n" +
            "Welcome to the Twitter Sentiment Analysis app.&lt;br&gt;\n" + 
            "What would you like to monitor?\n" +
            "&lt;/P&gt;\n" +
            "&lt;FORM action=\"/monitor\" method=\"get\"&gt;\n" +
            "&lt;P&gt;\n" +
            "&lt;INPUT type=\"text\" name=\"phrase\"&gt;&lt;br&gt;&lt;br&gt;\n" +
            "&lt;INPUT type=\"submit\" value=\"Go\"&gt;\n" +
            "&lt;/P&gt;\n" + "&lt;/FORM&gt;\n" + "&lt;/BODY&gt;";
        if (!monitoringPhrase) {
            res.send(welcomeResponse);
        } else {
            var monitoringResponse = "&lt;HEAD&gt;" +
                "&lt;META http-equiv=\"refresh\" content=\"5; URL=http://" +
                req.headers.host +
                "/\"&gt;\n" +
                "&lt;title&gt;Twitter Sentiment Analysis&lt;/title&gt;\n" +
                "&lt;/HEAD&gt;\n" +
                "&lt;BODY&gt;\n" +
                "&lt;P&gt;\n" +
                "The Twittersphere is feeling&lt;br&gt;\n" +
                "&lt;IMG align=\"middle\" src=\"" + sentimentImage() + "\"/&gt;&lt;br&gt;\n" +
                "about " + monitoringPhrase + ".&lt;br&gt;&lt;br&gt;" +
                "Analyzed " + tweetCount + " tweets...&lt;br&gt;" +
                "&lt;/P&gt;\n" +
                "&lt;A href=\"/reset\"&gt;Monitor another phrase&lt;/A&gt;\n" +
                "&lt;/BODY&gt;";
            res.send(monitoringResponse);
        }
    });</pre></div></div></div></div></div></div></div></div><p>We’ve finally put something at the root path of the app as
                Listing 7 shows. The first time through, the app presents a
                welcome prompt and gathers a phrase to monitor. It then sets up
                the monitoring stream and presents a results page. The tweeter’s
                stream callback is updated to pass the tweet contents through
                the sentiment function, increment the tweet count, and record
                the sentiment. Non-English tweets are filtered out.</p><p>For presentation purposes, the app uses the
                <code>sentimentImage()</code> function, which returns an image
                URL for a given sentiment value. The ranges for happy and grumpy
                are arbitrary. I found the range of sentiment to be surprisingly
                narrow for most topics, maybe due to the relative shortness of
                tweets. Feel free to play with these ranges.</p><p>So let’s give it a try. Here are the results of a few test
                runs:</p><h5>Figure 7. Twittersphere is positive about Justin
                    Bieber</h5><img alt="Smiling face icon expressing positive sentiment for the topic 'Justin Beiber' and the number of tweets analzyed (24)" src="fig7.jpg" width="208" /><h5>Figure 8. Twittersphere is ambivalent about
                    Syria</h5><img alt="Neutral face icon expressing neutral sentiment for the topic 'Syria' and the number of tweets analzyed (5)" src="fig9.jpg" width="205" /><h5>Figure 9. Twittersphere is angry about NSA, Snowden,
                    Manning, PRISM</h5><img alt="Ambivalent face icon expressing angry sentiment for the topics 'NSA, Snowden, PRISM' and the number of tweets analzyed (4)" src="fig8.jpg" width="222" /><div class="dw-article-ps-hbox"><h2 id="tools">Additional tooling
                considerations</h2><div id="cmt_8" class="cmt_icon"></div><div class="cmt_arrow">&nbsp;</div></div><p>In Step 1, I showed how you can use the <code>node</code> and
                <code>npm</code> commands to manage and run the application. You
                can easily do all of the coding with a text editor. However, in
                developing the app, I actually used a couple of other tools to
                ease my development.</p><p>Also, I ultimately wanted to push the app to a Cloud
                Foundry-compatible Node.js runtime environment, such as <a href="http://www.cloudfoundry.com">CloudFoundry.com</a> or
                IBM’s emerging <a href="http://www.ibm.com/software/ebusiness/jstart/bluemix/index.html ">BlueMix platform</a>. So the final app includes a few extra
                files required for that environment: the manifest.yml file
                describes the app and its resource needs to the Cloud Foundry
                runtime, and the npm-shrinkwrap.json files tell the Cloud
                Foundry Node.js runtime exactly which modules the app should be
                deployed with.</p><div class="dw-article-ps-hbox"><h2 id="IDCITJCG0LUMMTJFZENPTBBTV2HK02VI2SRCTDQVN2Z4HJ30UDQ1EH">Conclusion</h2><div id="cmt_9" class="cmt_icon"></div><div class="cmt_arrow">&nbsp;</div></div><p>In developing this app using Node.js, Express, ntwitter, and
                sentiment, I got a real appreciation for how easy it is to
                consume capabilities like Twitter access and sentiment analysis
                when they are packaged as Node.js modules. It’s easy to see why
                Node.js is so popular for developing web and mobile apps.</p><p>I'm now curious to try using Express to add a more professional
                user interface to the app. I think there's plenty of room to
                improve it. ; )</p><div class="ibm-rule dw-article-ps-topic-rule"><hr /></div><p><span class="dw-article-ps-topic-head">RELATED TOPICS:</span><a class="dw-article-ps-topic" href="http://www.ibm.com/developerworks/topics/nodejs/">Node.js</a><a class="dw-article-ps-topic" href="http://www.ibm.com/developerworks/topics/javascript/">JavaScript</a><a class="dw-article-ps-topic" href="http://www.ibm.com/developerworks/topics/social data analytics/">Social analytics</a></p><!--CMA ID: 0--><!--Site ID: 1--><!--XSLT stylesheet used to transform this file:
        dw-document-html-7.0.xsl--></div><div class="ibm-col-6-1"><p>RIGHT COLUMN RESERVED FOR INLINE COMMENTING<br />AREA DOES NOT APPEAR IN PREVIEW MODE</p></div></div><!--Rating_Meta_BEGIN--><div class="metavalue">static.content.url=http://www.ibm.com/developerworks/js/artrating/</div><div class="metavalue">SITE_ID=1</div><div class="metavalue">Zone=Big data and analytics, Rational</div><div class="metavalue">ArticleID=0</div><div class="metavalue">ArticleTitle=Making Watson a Rockstar: Integrating IBM Watson on Bluemix with Spotify and Genius.com</div><div class="metavalue">publish-date=02252014</div><script language="javascript" type="text/javascript">document.write('<div class="metavalue">url='+location.href.replace(/</g,  '%3C')+'</div>');</script><!--Rating_Meta_END--></div></div></div></div><!-- FOOTER_BEGIN --><div id="ibm-footer"><h2 class="ibm-access">Footer links</h2><ul><li><a href="http://www.ibm.com/developerworks/">developerWorks Worldwide</a></li><li><a href="http://www.ibm.com/contact/us/en/">Contact</a></li><li><a href="http://www.ibm.com/privacy/us/en/">Privacy</a></li><li><a href="http://www.ibm.com/legal/us/en/">Terms of use</a></li><li><a href="http://www.ibm.com/accessibility/us/en/">Accessibility</a></li></ul></div><!-- FOOTER_END --><!-- END_IBM-TOP --></div><div id="ibm-metrics" /></body></html>